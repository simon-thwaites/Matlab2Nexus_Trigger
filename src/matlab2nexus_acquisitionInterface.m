function matlab2nexus_acquisitionInterface(sessionString, pathList, trial_list)
% main acquisition interface for data capture
%
% ----------------------------------------------------------------------- %
% Created: 29/11/2019
% ----------------------------------------------------------------------- %
% Simnon Thwaites
% simonthwaites1991@gmail.com
% ----------------------------------------------------------------------- %

%% Create main figure
figTag = 'acq_figTag';
acquisitionFig = figure('numbertitle',      'off', ...
                'name',             'Matlab2Nexus Acquisition Interface', ...
                'menubar',          'none', ...
                'toolbar',          'none', ...
                'resize',           'on', ...
                'tag',              figTag, ...
                'renderer',         'painters', ...
                'units',            'normalized', ...
                'outerposition',    [0.2 0.2 0.6 0.6],...
                'HandleVisibility', 'callback'); % hide the handle to prevent unintended modifications
h.acquisitionFig = guihandles(acquisitionFig); % create handles attached to acquisitionFig

%% define GUI object positions (x-pos,y-pos, x-width, y-height)
% staticText_backgroundColour = [0.85 0.85 0.85];
staticText_backgroundColour = [0.94 0.94 0.94];

% trial_list_panel_position = [0.63 0.02 0.35 0.96];
trial_list_panel_position = [0.63 0.16 0.35 0.82];
session_info_panel_position = [0.02 0.85 0.6 0.13];
capture_panel_position = [0.02 0.3 0.6 0.53];
comments_panel_position = [0.02 0.02 0.6 0.26];
end_capture_panel_position = [0.63 0.02 0.35 0.12];

sessionString_textPosition = [0.01 0.6 0.98 0.3];
pathList_textPosition = [0.01 0.05 0.98 0.3];

comment_editField_position = [0.01 0.1 0.8 0.8];
comment_editField_staticText_position = [0.01 0.91 0.4 0.1];
comment_updateButton_position = [0.82 0.1 0.17 0.8];

trial_list_text_position = [0.01 0.01 0.8 0.98];

nowCapturing_staticText_position = [0.01 0.91 0.5 0.07];
trialNumber_staticText_staticText_position = [0.01 0.83 0.5 0.07];



%% Initialise UI values
h.acquisitionFig.thisCapture = ''; % start as empty
h.acquisitionFig.trialCellArray = cellstr(trial_list); % create cell array ferom trial list
% now create additional collumn for trial counter
h.acquisitionFig.trialCellArray = [h.acquisitionFig.trialCellArray repmat({'01'},size(h.acquisitionFig.trialCellArray,1),1)];


%% Define UI panels
h.acquisitionFig.trial_list_panel = uipanel(acquisitionFig, ...
                             'Title', 'Trial List', ...
                             'FontSize', 14, ...
                             'Position', trial_list_panel_position);
h.acquisitionFig.session_info_panel = uipanel(acquisitionFig, ...
                             'Title', 'Session Information', ...
                             'FontSize', 14, ...
                             'Position', session_info_panel_position);
h.acquisitionFig.capture_panel = uipanel(acquisitionFig, ...
                             'Title', 'Data Capture', ...
                             'FontSize', 18, ...
                             'Position', capture_panel_position);
h.acquisitionFig.comments_panel = uipanel(acquisitionFig, ...
                             'Title', 'Comments', ...
                             'FontSize', 14, ...
                             'Position', comments_panel_position);
h.acquisitionFig.end_capture_panel = uipanel(acquisitionFig, ...
                             'Title', 'End Capture Session', ...
                             'FontSize', 14, ...
                             'Position', end_capture_panel_position);


%% Define UI controls

% Session info panel objects
h.acquisitionFig.sessionString_Text = uicontrol('Parent',    h.acquisitionFig.session_info_panel, ...
                    'Style',    'text',...
                    'Units',    'normalized', ...
                    'String',   ['Session String:   ', sessionString],...
                    'BackgroundColor', staticText_backgroundColour, ...
                    'Position', sessionString_textPosition, ...
                    'HorizontalAlignment', 'left');
                
h.acquisitionFig.pathList_text = uicontrol('Parent',    h.acquisitionFig.session_info_panel, ...
                    'Style',    'text',...
                    'Units',    'normalized', ...
                    'String',   ['File Path:   ', pathList.session_dir],...
                    'BackgroundColor', staticText_backgroundColour, ...
                    'Position', pathList_textPosition, ...
                    'HorizontalAlignment','left');
                
% comment panel objects
h.acquisitionFig.comment_editField = uicontrol('Parent', h.acquisitionFig.comments_panel, ...
                    'Style',    'edit', ...
                    'Units',    'normalized', ...
                    'Position', comment_editField_position, ...
                    'String',   '<Press Enter after each comment change. Then commit the change with the push button to the right>',...
                    'Callback', @comment_CallBack);
h.acquisitionFig.comment_editField_staticText = uicontrol('Parent', h.acquisitionFig.comments_panel, ...
                    'Style',    'text', ...
                    'Units',    'normalized', ...
                    'Position', comment_editField_staticText_position, ...
                    'String',   'Enter comments on trial/data capture here: ', ...
                    'HorizontalAlignment','left');
h.acquisitionFig.comment_updateButton = uicontrol('Parent', h.acquisitionFig.comments_panel, ...
                    'Style',    'pushbutton', ...
                    'Units',    'normalized', ...
                    'Visible',  'off', ...
                    'String',   'Update Comment String', ...
                    'Position', comment_updateButton_position, ...
                    'Callback', @comment_updateButton_CallBack);
                
% trial list panel objects
h.acquisitionFig.trial_list_text = uicontrol('Parent', h.acquisitionFig.trial_list_panel, ...
                    'Style', 'listbox', ...
                    'Units',    'normalized', ...
                    'FontSize', 12, ...
                    'Position', trial_list_text_position, ...
                    'String', trial_list(:,1));

% capture panel objects
h.acquisitionFig.nowCapturing_staticText = uicontrol('Parent',    h.acquisitionFig.capture_panel, ...
                    'Style',    'text',...
                    'Units',    'normalized', ...
                    'String',   ['Now capturing:   ', h.acquisitionFig.thisCapture],...
                    'BackgroundColor', staticText_backgroundColour, ...
                    'Position', nowCapturing_staticText_position, ...
                    'HorizontalAlignment','left', ...
                    'FontSize', 10);
h.acquisitionFig.trialNumber_staticText = uicontrol('Parent',    h.acquisitionFig.capture_panel, ...
                    'Style',    'text',...
                    'Units',    'normalized', ...
                    'String',   ['Trial Number:   ', h.acquisitionFig.thisCapture],...
                    'BackgroundColor', staticText_backgroundColour, ...
                    'Position', trialNumber_staticText_staticText_position, ...
                    'HorizontalAlignment','left', ...
                    'FontSize', 10);               
 
guidata(acquisitionFig,h.acquisitionFig);

end

%% CALLBACKS
function comment_CallBack(text_object, ~, ~)
h.acquisitionFig = guidata(text_object);
set(h.acquisitionFig.comment_updateButton, 'Visible', 'on');
guidata(text_object, h.acquisitionFig)
end

function comment_updateButton_CallBack(pushButton_object, ~, ~)
h.acquisitionFig = guidata(pushButton_object);
h.acquisitionFig.commentString = h.acquisitionFig.comment_editField.String;
set(h.acquisitionFig.comment_updateButton, 'visible', 'off');

% need to save this comment field somewhere!!

guidata(pushButton_object, h.acquisitionFig)
end
